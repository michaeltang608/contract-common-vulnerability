const {
    time,
    loadFixture,
} = require("@nomicfoundation/hardhat-network-helpers");
const { anyValue } = require("@nomicfoundation/hardhat-chai-matchers/withArgs");
const { expect } = require("chai");
const { ethers } = require("hardhat");

describe("delegatecall", function () {
    async function deploy() {
        const DelegatecallLib = await ethers.getContractFactory("DelegatecallLib");
        const DelegateCallGame = await ethers.getContractFactory("DelegateCallGame");
        const DelegateCallGame2 = await ethers.getContractFactory("DelegateCallGame2");
        const delegatecallLib = await DelegatecallLib.deploy();
        const delegateCallGame = await DelegateCallGame.deploy(delegatecallLib.address);
        const delegateCallGame2 = await DelegateCallGame2.deploy(delegatecallLib.address);
        return { delegateCallGame, delegateCallGame2 }
    }
    describe('testAll', function () {
        it('正常情况', async () => {
            const { delegateCallGame } = await loadFixture(deploy);
            console.log(`初始化的award: ${await delegateCallGame.award()}`)
            await delegateCallGame.play(3)
            console.log(`函数调用后，award的值是: ${await delegateCallGame.award()}`)
            console.log(`函数调用后，libAddress 的值是: ${await delegateCallGame.libAddress()}`)
        }
        );
        it('异常情况', async () => {
            const { delegateCallGame2 } = await loadFixture(deploy);
            console.log(`初始化的award: ${await delegateCallGame2.award()}`)
            await delegateCallGame2.play(3)
            console.log(`函数调用后，award的值是: ${await delegateCallGame2.award()}`)
            console.log(`函数调用后，libAddress 的值是: ${await delegateCallGame2.libAddress()}`)

        }
        );
    })

});

